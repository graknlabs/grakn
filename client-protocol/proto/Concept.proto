syntax = "proto3";

option java_package = "ai.grakn.rpc.proto";
option java_outer_classname = "ConceptProto";

package session;

message Method {
    message Req {
        oneof req {
            // Concept method requests
            Concept.Delete.Req concept_delete = 100;

            // SchemaConcept method requests
            SchemaConcept.IsImplicit.Req schemaConcept_isImplicit = 200;
            SchemaConcept.GetLabel.Req schemaConcept_getLabel = 201;
            SchemaConcept.SetLabel.Req schemaConcept_setLabel = 202;
            SchemaConcept.GetSup.Req schemaConcept_getSup = 203;
            SchemaConcept.SetSup.Req schemaConcept_setSup = 204;
            SchemaConcept.Sups.Req schemaConcept_sups = 205;
            SchemaConcept.Subs.Req schemaConcept_subs = 206;

            // Rule method requests
            Rule.When.Req rule_when = 300;
            Rule.Then.Req rule_then = 301;

            // Role method requests
            Role.Relations.Req role_relations = 401;
            Role.Players.Req role_players = 402;

            // Type method requests
            Type.IsAbstract.Req type_isAbstract = 500;
            Type.SetAbstract.Req type_setAbstract = 501;
            Type.Instances.Req type_instances = 502;
            Type.Keys.Req type_keys = 503;
            Type.Attributes.Req type_attributes = 504;
            Type.Playing.Req type_playing = 505;
            Type.Has.Req type_has = 506;
            Type.Key.Req type_key = 507;
            Type.Plays.Req type_plays = 508;
            Type.Unhas.Req type_unhas = 509;
            Type.Unkey.Req type_unkey = 510;
            Type.Unplay.Req type_unplay = 511;

            // EntityType method requests
            EntityType.Create.Req entityType_create = 600;

            // RelationshipType method requests
            RelationType.Create.Req relationType_create = 700;
            RelationType.Roles.Req relationType_roles = 701;
            RelationType.Relates.Req relationType_relates = 702;
            RelationType.Unrelate.Req relationType_unrelate = 703;

            // AttributeType method requests
            AttributeType.Create.Req attributeType_create = 800;
            AttributeType.Attribute.Req attributeType_attribute = 801;
            AttributeType.DataType.Req attributeType_dataType = 802;
            AttributeType.GetRegex.Req attributeType_getRegex = 803;
            AttributeType.SetRegex.Req attributeType_setRegex = 804;

            // Thing method requests
            Thing.Type.Req thing_type = 900;
            Thing.IsInferred.Req thing_isInferred = 901;
            Thing.Keys.Req thing_keys = 902;
            Thing.Attributes.Req thing_attributes = 903;
            Thing.Relations.Req thing_relations = 904;
            Thing.Roles.Req thing_roles = 905;
            Thing.Relhas.Req thing_relhas = 906;
            Thing.Unhas.Req thing_unhas = 907;

            // Relationship method requests
            Relation.RolePlayersMap.Req relation_rolePlayersMap = 1000;
            Relation.RolePlayers.Req relation_rolePlayers = 1001;
            Relation.Assign.Req relation_assign = 1002;
            Relation.Unassign.Req relation_unassign = 1003;

            // Attribute method requests
            Attribute.Value.Req attribute_value = 1100;
            Attribute.Owners.Req attribute_owners = 1101;
        }
    }
    message Res {
        oneof res {
            // Concept method responses
            Concept.Delete.Res concept_delete = 100;

            // SchemaConcept method responses
            SchemaConcept.IsImplicit.Res schemaConcept_isImplicit = 200;
            SchemaConcept.GetLabel.Res schemaConcept_getLabel = 201;
            SchemaConcept.SetLabel.Res schemaConcept_setLabel = 202;
            SchemaConcept.GetSup.Res schemaConcept_getSup = 203;
            SchemaConcept.SetSup.Res schemaConcept_setSup = 204;
            SchemaConcept.Sups.Iter schemaConcept_sups = 205;
            SchemaConcept.Subs.Iter schemaConcept_subs = 206;

            // Rule method responses
            Rule.When.Res rule_when = 300;
            Rule.Then.Res rule_then = 301;

            // Role method responses
            Role.Relations.Iter role_relations = 401;
            Role.Players.Iter role_players = 402;

            // Type method responses
            Type.IsAbstract.Res type_isAbstract = 500;
            Type.SetAbstract.Res type_setAbstract = 501;
            Type.Instances.Iter type_instances = 502;
            Type.Keys.Iter type_keys = 503;
            Type.Attributes.Iter type_attributes = 504;
            Type.Playing.Iter type_playing = 505;
            Type.Has.Res type_has = 506;
            Type.Key.Res type_key = 507;
            Type.Plays.Res type_plays = 508;
            Type.Unhas.Res type_unhas = 509;
            Type.Unkey.Res type_unkey = 510;
            Type.Unplay.Res type_unplay = 511;

            // EntityType method responses
            EntityType.Create.Res entityType_create = 600;

            // RelationshipType method responses
            RelationType.Create.Res relationType_create = 700;
            RelationType.Roles.Iter relationType_roles = 701;
            RelationType.Relates.Res relationType_relates = 702;
            RelationType.Unrelate.Res relationType_unrelate = 703;

            // AttributeType method responses
            AttributeType.Create.Res attributeType_create = 800;
            AttributeType.Attribute.Res attributeType_attribute = 801;
            AttributeType.DataType.Res attributeType_dataType = 802;
            AttributeType.GetRegex.Res attributeType_getRegex = 803;
            AttributeType.SetRegex.Res attributeType_setRegex = 804;

            // Thing method responses
            Thing.Type.Res thing_type = 900;
            Thing.IsInferred.Res thing_isInferred = 901;
            Thing.Keys.Iter thing_keys = 902;
            Thing.Attributes.Iter thing_attributes = 903;
            Thing.Relations.Iter thing_relations = 904;
            Thing.Roles.Iter thing_roles = 905;
            Thing.Relhas.Res thing_relhas = 906;
            Thing.Unhas.Res thing_unhas = 907;

            // Relationship method responses
            Relation.RolePlayersMap.Iter relation_rolePlayersMap = 1000;
            Relation.RolePlayers.Iter relation_rolePlayers = 1001;
            Relation.Assign.Res relation_assign = 1002;
            Relation.Unassign.Res relation_unassign = 1003;

            // Attribute method responses
            Attribute.Value.Res attribute_value = 1100;
            Attribute.Owners.Iter attribute_owners = 1101;
        }
    }

    message Iter {
        message Res {
            // SchemaConcept iterator responses
            SchemaConcept.Sups.Iter.Res schemaConcept_sups = 205;
            SchemaConcept.Subs.Iter.Res schemaConcept_subs = 206;

            // Role iterator responses
            Role.Relations.Iter.Res role_relations = 401;
            Role.Players.Iter.Res role_players = 402;

            // Type iterator responses
            Type.Instances.Iter.Res type_instances = 502;
            Type.Keys.Iter.Res type_keys = 503;
            Type.Attributes.Iter.Res type_attributes = 504;
            Type.Playing.Iter.Res type_playing = 505;

            // RelationType iterator responses
            RelationType.Roles.Iter.Res relationType_roles = 701;

            // Thing iterator responses
            Thing.Keys.Iter.Res thing_keys = 902;
            Thing.Attributes.Iter.Res thing_attributes = 903;
            Thing.Relations.Iter.Res thing_relations = 904;
            Thing.Roles.Iter.Res thing_roles = 905;

            // Relation iterator responses
            Relation.RolePlayersMap.Iter.Res relation_rolePlayersMap = 1000;
            Relation.RolePlayers.Iter.Res relation_rolePlayers = 1001;

            // Attribute iterator responses
            Attribute.Owners.Iter.Res attribute_owners = 1101;
        }
    }
}

message Null {} // Indicates that a request does not yield any result

// Concept methods

message Concept {
    string id = 1;
    BASE_TYPE baseType = 2;

    enum BASE_TYPE {
        META_TYPE = 0; // This represents the top-level meta type only
        ENTITY_TYPE = 1;
        RELATIONSHIP_TYPE = 3;
        ATTRIBUTE_TYPE = 4;
        ENTITY = 5;
        RELATIONSHIP = 6;
        ATTRIBUTE = 7;
        ROLE = 8;
        RULE = 9;
    }

    message Delete {
        message Req {}
        message Res {}
    }
}

// SchemaConcept methods

message SchemaConcept {

    message GetLabel {
        message Req {}
        message Res {
            string label = 1;
        }
    }

    message SetLabel {
        message Req {
            string label = 1;
        }
        message Res {}
    }

    message IsImplicit {
        message Req{}
        message Res{
            bool implicit = 1;
        }
    }

    message GetSup {
        message Req {}
        message Res {
            oneof res {
                Concept concept = 1;
                Null null = 2;
            }
        }
    }

    message SetSup {
        message Req {
            Concept concept = 1;
        }
        message Res {}
    }
    
    message Sups {
        message Req {}
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }
    
    message Subs {
        message Req {}
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }
}


// Rule methods

message Rule {

    message When {
        message Req {}
        message Res {
            oneof res {
                string pattern = 1;
                Null null = 2;
            }
        }
    }

    message Then {
        message Req {}
        message Res {
            oneof res {
                string pattern = 1;
                Null null = 2;
            }
        }
    }
}


// Role methods

message Role {

    message Relations {
        message Req {}
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }

    message Players {
        message Req {}
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }
}


// Type methods

message Type {

    message IsAbstract {
        message Req {}
        message Res {
            bool abstract = 1;
        }
    }

    message SetAbstract {
        message Req {
            bool abstract = 1;
        }
        message Res {}
    }

    message Instances {
        message Req {}
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }

    message Attributes {
        message Req {}
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }

    message Keys {
        message Req {}
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }

    message Playing {
        message Req {}
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }

    message Has {
        message Req {
            Concept concept = 1;
        }
        message Res {}
    }

    message Unhas {
        message Req {
            Concept concept = 1;
        }
        message Res {}
    }

    message Key {
        message Req {
            Concept concept = 1;
        }
        message Res {}
    }

    message Unkey {
        message Req {
            Concept concept = 1;
        }
        message Res {}
    }

    message Plays {
        message Req {
            Concept concept = 1;
        }
        message Res {}
    }

    message Unplay {
        message Req {
            Concept concept = 1;
        }
        message Res {}
    }
}


// EntityType methods

message EntityType {

    message Create {
        message Req {}
        message Res {
            Concept concept = 1;
        }
    }
}


// RelationshipType methods

message RelationType {

    message Create {
        message Req {}
        message Res {
            Concept concept = 1;
        }
    }

    message Roles {
        message Req {}
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }

    message Relates {
        message Req {
            Concept concept = 1;
        }
        message Res {}
    }

    message Unrelate {
        message Req {
            Concept concept = 1;
        }
        message Res {}
    }
}


// AttributeType methods

message AttributeType {

    enum DATA_TYPE {
        String = 0;
        Boolean = 1;
        Integer = 2;
        Long = 3;
        Float = 4;
        Double = 5;
        Date = 6;
    }

    message Create {
        message Req {
            ValueObject value = 1;
        }
        message Res {
            Concept concept = 1;
        }
    }

    message Attribute {
        message Req {
            ValueObject value = 1;
        }
        message Res {
            oneof res {
                Concept concept = 1;
                Null null = 2;
            }
        }
    }

    message DataType {
        message Req {}
        message Res {
            oneof res {
                DATA_TYPE dataType = 1;
                Null null = 2;
            }
        }
    }

    message GetRegex {
        message Req {}
        message Res {
            string regex = 1;
        }
    }

    message SetRegex {
        message Req {
            string regex = 1;
        }
        message Res {}
    }
}


// Thing methods

message Thing {

    message IsInferred {
        message Req {}
        message Res {
            bool inferred = 1;
        }
    }

    message Type {
        message Req {}
        message Res {
            Concept concept = 1;
        }
    }

    message Keys {
        message Req {
            repeated Concept concepts = 1;
        }
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }

    message Attributes {
        message Req {
            repeated Concept concepts = 1;
        }
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }

    message Relations {
        message Req {
            repeated Concept concepts = 1;
        }
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }

    message Roles {
        message Req {}
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }

    message Relhas {
        message Req {
            Concept concept = 1;
        }
        message Res {
            Concept concept = 1;
        }
    }

    message Unhas {
        message Req {
            Concept concept = 1;
        }
        message Res {}
    }
}


// Relationship methods

message Relation {

    message RolePlayersMap {
        message Req {}
        message Iter {
            int32 id = 1;
            message Res {
                Concept role = 1;
                Concept player = 2;
            }
        }
    }

    message RolePlayers {
        message Req {
            repeated Concept concepts = 1;
        }
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }

    message Assign {
        message Req {
            Concept role = 1;
            Concept player = 2;
        }
        message Res {}
    }

    message Unassign {
        message Req {
            Concept role = 1;
            Concept player = 2;
        }
        message Res {}
    }
}

// Attribute methods

message Attribute {

    message Value {
        message Req {}
        message Res {
            ValueObject value = 1;
        }
    }

    message Owners {
        message Req {}
        message Iter {
            int32 id = 1;
            message Res {
                Concept concept = 1;
            }
        }
    }
}

// Attribute Value object

message ValueObject {
    oneof value {
        string string = 1;
        bool boolean = 2;
        int32 integer = 3;
        int64 long = 4;
        float float = 5;
        double double = 6;
        int64 date = 7; // time since epoch in milliseconds
    }
}